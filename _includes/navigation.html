<!-- Main Navigation -->
<nav class="main-nav" role="navigation" aria-label="Main navigation">
  <div class="main-nav__container">
    <!-- Mobile menu button -->
    <button class="main-nav__toggle" 
            id="nav-toggle" 
            aria-expanded="false" 
            aria-controls="nav-menu"
            aria-label="Toggle navigation menu">
      <span class="main-nav__toggle-bar"></span>
      <span class="main-nav__toggle-bar"></span>
      <span class="main-nav__toggle-bar"></span>
    </button>

    <!-- Navigation menu -->
    <div class="main-nav__menu" id="nav-menu">
      <ul class="main-nav__list">
        {% for item in site.navigation %}
          {% assign current_path = page.url | remove: '.html' %}
          {% assign nav_path = item.url | remove: '.html' %}
          
          <li class="main-nav__item">
            <a href="{{ item.url | relative_url }}" 
               class="main-nav__link{% if current_path == nav_path or (nav_path == '/' and current_path == '/index') %} main-nav__link--active{% endif %}"
               {% if current_path == nav_path or (nav_path == '/' and current_path == '/index') %}aria-current="page"{% endif %}>
              {{ item.name }}
            </a>
          </li>
        {% endfor %}
      </ul>
      
      <!-- Social links in mobile menu -->
      <div class="main-nav__social">
        {% if site.social_media %}
          {% for account in site.social_media %}
            {% assign service_key = account[0] %}
            {% assign identifier = account[1] %}
            {% assign service = site.data.social_media[service_key] %}
            {% if service and identifier %}
              {% assign profile_url = service.profile_url_prefix | append: identifier %}
              <a href="{{ profile_url }}"
                 class="main-nav__social-link"
                 aria-label="{{ service.name }}: {{ identifier }}"
                 title="{{ service.name }}">
                {{ service.icon_svg }}
              </a>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
</nav>

<script>
  // Navigation functionality
  (function() {
    const navToggle = document.getElementById('nav-toggle');
    const navMenu = document.getElementById('nav-menu');
    
    if (navToggle && navMenu) {
      navToggle.addEventListener('click', function() {
        const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
        
        // Toggle aria-expanded
        navToggle.setAttribute('aria-expanded', !isExpanded);
        
        // Toggle menu visibility
        navMenu.classList.toggle('main-nav__menu--open');
        
        // Toggle body scroll lock on mobile
        document.body.classList.toggle('nav-open', !isExpanded);
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', function(e) {
        if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
          navToggle.setAttribute('aria-expanded', 'false');
          navMenu.classList.remove('main-nav__menu--open');
          document.body.classList.remove('nav-open');
        }
      });
      
      // Close menu on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && navMenu.classList.contains('main-nav__menu--open')) {
          navToggle.setAttribute('aria-expanded', 'false');
          navMenu.classList.remove('main-nav__menu--open');
          document.body.classList.remove('nav-open');
          navToggle.focus();
        }
      });
      
      // Handle window resize
      window.addEventListener('resize', function() {
        if (window.innerWidth >= 768) {
          navToggle.setAttribute('aria-expanded', 'false');
          navMenu.classList.remove('main-nav__menu--open');
          document.body.classList.remove('nav-open');
        }
      });
    }
  })();
</script>
